{"version":3,"file":"Main.js","sourceRoot":"","sources":["../src/Main.ts"],"names":[],"mappings":"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","sourcesContent":["class Main extends egret.DisplayObjectContainer {\n    public constructor() {\n        super();\n        this.addEventListener(egret.Event.ADDED_TO_STAGE, runDemo, null);\n    }\n}\nwindow[\"Main\"] = Main;\n\nfunction runDemo() {\n    createTank();\n    createBoy1();\n    createBoy2();\n}\n\nasync function createTank() {\n    let stage = egret.lifecycle.stage;\n    let tank = await loadSpine('tank');\n\n    stage.addChild(tank);\n    enableDragging(tank);\n    tank.y = stage.stageHeight * 0.8;\n    tank.scaleX = tank.scaleY = 0.2;\n\n    // event callback\n    tank.start(0).add('drive', 0, {\n        loopStart() {\n            tank.x = tank.scaleX > 0 ? 200 : 1000;\n            tank.scaleX *= -1;\n        }\n    });\n}\n\nasync function createBoy1() {\n    let stage = egret.lifecycle.stage;\n    let boy = await loadSpine('spineboy');\n\n    stage.addChild(boy);\n    enableDragging(boy);\n    boy.x = 1280 * 0.3;\n    boy.y = stage.stageHeight * 0.5;\n    boy.scaleX = boy.scaleY = 0.2;\n\n    // chaining\n    await boy\n        .play('idle', 1)\n        .add('walk', 1)\n        .add('run', 1)\n        .waitTrackEnd();\n\n    // imperatively\n    while (true) {\n        let track = boy.start(0);\n\n        for (let anim of boy.skeletonData.animations) {\n            track.add(anim.name, 1);\n        }\n        await track.waitTrackEnd();\n    }\n}\n\nasync function createBoy2() {\n    let stage = egret.lifecycle.stage;\n    let boy = await loadSpine('spineboy');\n\n    stage.addChild(boy);\n    enableDragging(boy);\n    boy.x = 1280 * 0.6;\n    boy.y = stage.stageHeight * 0.5;\n    boy.scaleX = boy.scaleY = 0.2;\n\n    // await event\n    await boy.play('run').waitNamedEvent('footstep');\n\n    while (true) {\n        // await animation sequence\n        await boy.play('jump', 1).add('run', 2).waitTrackEnd();\n    }\n}\n\n// helpers\n\nfunction loadImage(url: string): Promise<egret.Texture> {\n    return new Promise(resolve => {\n        let loader = new egret.ImageLoader();\n        let texture = new egret.Texture();\n\n        loader.once(egret.Event.COMPLETE, () => {\n            texture.bitmapData = loader.data;\n            resolve(texture);\n        }, null);\n\n        loader.load(url);\n    });\n}\n\nfunction loadText(url: string): Promise<string> {\n    return new Promise(resolve => {\n        let request = new egret.HttpRequest();\n        request.responseType = egret.HttpResponseType.TEXT;\n        request.open(url, 'GET');\n        request.send();\n        request.once(egret.Event.COMPLETE, () => {\n            resolve(request.response);\n        }, null)\n    });\n}\n\nasync function loadSpine(name: string) {\n    let json = await loadText('assets/' + name + '.json');\n    let atlas = await loadText('assets/' + name + '.atlas');\n    let texAtlas = spine.createTextureAtlas(atlas, {\n        [name + '.png']: await loadImage('assets/' + name + '.png')\n    });\n    let skelData = spine.createSkeletonData(json, texAtlas);\n\n    return new spine.SkeletonAnimation(skelData);\n}\n\nfunction addAnimation(animation: spine.SkeletonAnimation, x: number, y: number) {\n    let stage = egret.lifecycle.stage;\n    animation.x = stage.stageWidth * x;\n    animation.y = stage.stageHeight * y;\n    animation.anchorOffsetX = animation.width / 2;\n    animation.anchorOffsetY = animation.height / 2;\n    animation.scaleX = animation.scaleY = 200 / animation.height;\n    stage.addChild(animation);\n    enableDragging(animation);\n}\n\nfunction enableDragging(target: egret.DisplayObject) {\n    let stage = egret.lifecycle.stage;\n    let dragging = false;\n    let dx = 0, dy = 0;\n\n    target.addEventListener(egret.TouchEvent.TOUCH_BEGIN, (event: egret.TouchEvent) => {\n        dragging = true;\n        dx = event.stageX - target.x;\n        dy = event.stageY - target.y;\n    }, null);\n\n    stage.addEventListener(egret.TouchEvent.TOUCH_MOVE, (event: egret.TouchEvent) => {\n        if (dragging) {\n            target.x = event.stageX - dx;\n            target.y = event.stageY - dy;\n        }\n    }, null);\n\n    target.addEventListener(egret.TouchEvent.TOUCH_END, _ => dragging = false, null);\n    target.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE, _ => dragging = false, null);\n}"]}